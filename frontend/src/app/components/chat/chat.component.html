<div class="grid grid-rows-[auto_1fr_min-content] h-full p-2">
  <div class="flex justify-between">
    <h1>Chat with {{ targetUsername }}</h1>
    <button
      class="bg-transparent hover:bg-indigo-400 text-indigo-700 mb-2 font-semibold text-sm hover:text-white py-1 px-2 border border-indigo-500 hover:border-transparent rounded"
      (click)="leaveChat()"
    >
      Cancel
    </button>
  </div>
  <div
    class="flex gap-2 overflow-y-scroll max-h-[calc(100dvh-11.5rem)] flex flex-col flex-1"
  >
    @for (msg of messages; track msg) {
      <div
        class="p-2 bg-slate-200 w-2/3"
        [class.self-end]="msg.ownMessage"
        [class.self-start]="!msg.ownMessage"
        [class.!bg-sky-200]="msg.ownMessage"
      >
        {{ msg.message }}
      </div>
    }
  </div>
  <div>
    <form
      class="w-full grid gap-2 grid-cols-[minmax(0,1fr)_auto]"
      [formGroup]="chatForm"
      (submit)="sendMessage()"
    >
      <textarea
        class="resize-none border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 p-1 rounded-lg h-full text-sm placeholder:text-gray-500"
        formControlName="message"
        type="text"
        placeholder="Your message"
      ></textarea>
      <button
        type="submit"
        class="h-full text-sm bg-indigo-400 hover:bg-indigo-300 disabled:bg-indigo-100 rounded-lg p-1 md:p-2 lg:p-3"
        [disabled]="chatForm.invalid"
      >
        Send
      </button>
    </form>
  </div>
</div>
